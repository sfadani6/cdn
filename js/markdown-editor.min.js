class SFMarkdownEditor{constructor(){this.editorTabs=document.querySelector("#wp-content-editor-tools .wp-editor-tabs"),this.wpEditorContainer=document.getElementById("wp-content-editor-container"),this.visualTab=document.getElementById("content-tmce"),this.codeTab=document.getElementById("content-html"),this.turndownService=new TurndownService({headingStyle:"atx",codeBlockStyle:"fenced"}),this.debounce=(e,t)=>{let n;return function(...i){const o=this;clearTimeout(n),n=setTimeout(()=>e.apply(o,i),t)}},this.init()}init(){this.createUI(),this.bindEvents(),this.switchView("visual")}createUI(){const e=`
        #sf-lto-markup-tab { padding-left: 10px; padding-right: 10px; }
        #sf-lto-markup-tab.active { background: #f0f0f0; color: #333; border-bottom-color: #f0f0f0; }
    `,t=document.createElement("style");t.textContent=e,document.head.appendChild(t),this.editorTabs.insertAdjacentHTML("beforeend",'<button type="button" id="sf-lto-markup-tab" class="wp-switch-editor switch-html">\uB9C8\uD06C\uC5C5</button>'),this.wpEditorContainer.insertAdjacentHTML("afterend",`<textarea id="sf-lto-markdown-textarea" style="display: none; width: 100%; height: 400px; font-family: 'D2Coding', monospace; padding: 10px; box-sizing: border-box; resize: vertical;"></textarea>`),this.markupTab=document.getElementById("sf-lto-markup-tab"),this.markupTextarea=document.getElementById("sf-lto-markdown-textarea")}bindEvents(){this.visualTab.addEventListener("click",t=>{t.preventDefault(),this.switchView("visual")}),this.codeTab.addEventListener("click",t=>{t.preventDefault(),this.switchView("code")}),this.markupTab.addEventListener("click",t=>{t.preventDefault(),this.switchView("markup")});const e=this.debounce(this.convertMarkupToHtml.bind(this),400);this.markupTextarea.addEventListener("input",e)}switchView(e){if(this.visualTab.classList.remove("active"),this.codeTab.classList.remove("active"),this.markupTab.classList.remove("active"),e==="visual"||e==="code"){this.wpEditorContainer.style.display="block",this.markupTextarea.style.display="none";const t=e==="visual"?this.visualTab:this.codeTab;t.classList.add("active"),typeof switchEditors<"u"&&typeof switchEditors.switchTo=="function"&&switchEditors.switchTo(t)}else e==="markup"&&(this.wpEditorContainer.style.display="none",this.markupTextarea.style.display="block",this.markupTab.classList.add("active"),this.convertHtmlToMarkup())}convertHtmlToMarkup(){const e=document.getElementById("content");if(e){const t=e.value,n=this.turndownService.turndown(t);this.markupTextarea.value=n}}convertMarkupToHtml(){const e=this.markupTextarea.value;if(e.trim()===""){document.getElementById("content").value="";const i=typeof tinymce<"u"?tinymce.get("content"):null;i&&i.setContent("");return}const t=marked.parse(e,{gfm:!0,breaks:!0,sanitize:!1});document.getElementById("content").value=t;const n=typeof tinymce<"u"?tinymce.get("content"):null;n&&n.setContent(t)}}document.addEventListener("DOMContentLoaded",function(){document.getElementById("wp-content-editor-container")&&new SFMarkdownEditor});
