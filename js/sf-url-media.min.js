class SfUrlMediaJson{constructor(){this.mediaData=null,this.selectedItem=null,document.addEventListener("click",t=>{t.target&&t.target.id==="sf-lto-insert-media-btn"&&this.insertIntoEditor()})}loadJson(){const t=document.getElementById("sf-lto-json-source-select"),l=document.getElementById("sf-lto-media-grid-container"),e=document.getElementById("sf-lto-insert-media-btn"),i=document.getElementById("sf-lto-media-details-container");if(!t||!l||!e||!i){console.error("\uD544\uC218 UI \uC694\uC18C\uB97C \uCC3E\uC744 \uC218 \uC5C6\uC2B5\uB2C8\uB2E4.");return}const s=t.value;if(!s){alert("\uBD88\uB7EC\uC62C JSON \uD30C\uC77C\uC758 URL\uC744 \uC120\uD0DD\uD574\uC8FC\uC138\uC694.");return}l.innerHTML="<p>\uB370\uC774\uD130\uB97C \uBD88\uB7EC\uC624\uB294 \uC911\uC785\uB2C8\uB2E4...</p>",e.disabled=!0,i.classList.remove("is-visible"),this.selectedItem=null,fetch(s).then(n=>{if(!n.ok)throw new Error(`\uB124\uD2B8\uC6CC\uD06C \uC751\uB2F5 \uC624\uB958 (\uC0C1\uD0DC: ${n.status})`);return n.json()}).then(n=>{this.mediaData=n,console.log("JSON \uB370\uC774\uD130 \uB85C\uB4DC \uC131\uACF5:",this.mediaData),this.drawJson()}).catch(n=>{console.error("JSON \uB370\uC774\uD130 \uB85C\uB4DC \uC911 \uC5D0\uB7EC:",n),l.innerHTML='<p style="color: red;">\uB370\uC774\uD130 \uB85C\uB4DC\uC5D0 \uC2E4\uD328\uD588\uC2B5\uB2C8\uB2E4. \uAC1C\uBC1C\uC790 \uCF58\uC194\uC744 \uD655\uC778\uD574\uC8FC\uC138\uC694.</p>',alert("\uB370\uC774\uD130 \uB85C\uB4DC\uC5D0 \uC2E4\uD328\uD588\uC2B5\uB2C8\uB2E4. URL\uC774 \uC720\uD6A8\uD55C\uC9C0 \uD655\uC778\uD574\uC8FC\uC138\uC694.")})}drawJson(){const t=document.getElementById("sf-lto-media-grid-container");if(!t)return;if(!this.mediaData||!this.mediaData.tree||!Array.isArray(this.mediaData.tree.children)){console.error("\uC720\uD6A8\uD558\uC9C0 \uC54A\uC740 JSON \uB370\uC774\uD130 \uAD6C\uC870\uC785\uB2C8\uB2E4."),t.innerHTML="<p>\uB370\uC774\uD130\uB97C \uD45C\uC2DC\uD560 \uC218 \uC5C6\uC2B5\uB2C8\uB2E4. JSON \uAD6C\uC870\uB97C \uD655\uC778\uD574\uC8FC\uC138\uC694.</p>";return}const l=this.generateImageItems(this.mediaData.tree.children);l?(t.innerHTML=`<ul class="sf-lto-media-grid">${l}</ul>`,this.setupItemSelection()):t.innerHTML="<p>\uD45C\uC2DC\uD560 \uC774\uBBF8\uC9C0\uAC00 \uC5C6\uC2B5\uB2C8\uB2E4.</p>"}generateImageItems(t){let l="";return t.forEach(e=>{e.type==="img"?l+=`
                    <li class="sf-lto-media-item" data-path="${e.path}" title="${e.filename}">
                        <div class="sf-lto-media-item__thumbnail">
                            <img src="${e.thumburl}" alt="${e.filename}" loading="lazy">
                        </div>
                        <div class="sf-lto-media-item__filename">${e.filename}</div>
                    </li>
                `:e.type==="folder"&&Array.isArray(e.children)&&(l+=this.generateImageItems(e.children))}),l}setupItemSelection(){const t=document.querySelector(".sf-lto-media-grid");t&&t.addEventListener("click",l=>{const e=l.target.closest(".sf-lto-media-item");if(!e)return;const i=t.querySelector(".sf-lto-media-item.selected");i&&i.classList.remove("selected"),e.classList.add("selected");const s=e.dataset.path;this.selectedItem=this.findItemByPath(this.mediaData.tree.children,s),this.selectedItem&&(console.log("\uC120\uD0DD\uB41C \uC544\uC774\uD15C:",this.selectedItem),this.updateDetailsPanel(),document.getElementById("sf-lto-insert-media-btn").disabled=!1)})}findItemByPath(t,l){for(const e of t){if(e.path===l)return e;if(e.type==="folder"&&e.children){const i=this.findItemByPath(e.children,l);if(i)return i}}return null}updateDetailsPanel(){const t=document.getElementById("sf-lto-media-details-container");!this.selectedItem||!t||(t.classList.add("is-visible"),document.getElementById("sf-lto-details-thumb").src=this.selectedItem.thumburl,document.getElementById("sf-lto-details-filename").textContent=this.selectedItem.filename,document.getElementById("sf-lto-details-dimensions").textContent=this.selectedItem.resolution,document.getElementById("sf-lto-details-filesize").textContent=`${(this.selectedItem.size/1024).toFixed(1)} KB`,document.getElementById("sf-lto-details-alt").value=this.selectedItem.name,document.getElementById("sf-lto-details-title").value=this.selectedItem.name,document.getElementById("sf-lto-details-caption").value="",document.getElementById("sf-lto-details-description").value="",document.getElementById("sf-lto-details-url").value=this.selectedItem.url)}insertIntoEditor(){if(!this.selectedItem){alert("\uC0BD\uC785\uD560 \uC774\uBBF8\uC9C0\uB97C \uC120\uD0DD\uD574\uC8FC\uC138\uC694.");return}const t=this.selectedItem.url,l=document.getElementById("sf-lto-details-alt").value,e=document.getElementById("sf-lto-details-title").value,i=document.getElementById("sf-lto-details-caption").value;let s;i.trim()!==""?s=`[caption align="alignnone" width=""]<img src="${t}" alt="${l}" title="${e}" /> ${i}[/caption]`:s=`<img src="${t}" alt="${l}" title="${e}" />`,typeof window.parent.send_to_editor=="function"?(window.parent.send_to_editor(s),window.parent.tb_remove()):alert("\uC5D0\uB514\uD130\uB97C \uCC3E\uC744 \uC218 \uC5C6\uC2B5\uB2C8\uB2E4.")}}const sfUrlMediaManager=new SfUrlMediaJson;
